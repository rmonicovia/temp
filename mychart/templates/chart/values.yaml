azure: false

pod:
  imagePullSecrets: []
  securityContext: {}
  annotations: {}
  tolerations: []
  affinity: {}

{{ $ktmz_hpa := (.Files.Get (print "target/kustomize/" $.Values.base_path "/hpa.yaml") | fromYaml) -}}
{{ if $ktmz_hpa -}}
  {{ if or (hasKey $ktmz_hpa.spec "minReplicas") (hasKey $ktmz_hpa.spec "maxReplicas") -}}
hpa:
    {{- if $ktmz_hpa.spec.minReplicas }}
  minReplicas: {{ $ktmz_hpa.spec.minReplicas }}
    {{- end -}}
    {{- if $ktmz_hpa.spec.maxReplicas }}
  maxReplicas: {{ $ktmz_hpa.spec.maxReplicas }}
    {{- end -}}
  {{- end -}}
{{- end }}

fullnameOverride: ""

nameOverride: ""

serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # Annotations to add to the service account
  annotations: {}
  # The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template
  name: ""

{{ $ktmz_service := (.Files.Get "target/kustomize/base/service.yaml" | fromYaml) -}}
service:
  type: {{ $ktmz_service.spec.type }}
  port: {{ (index $ktmz_service.spec.ports 0).port }}

{{ $ktmz_deployment := (.Files.Get "target/kustomize/base/deployment.yaml" | fromYaml) -}}
container:
  securityContext: {{ $ktmz_deployment.spec.template.spec.securityContext | toYaml }}

  nodeSelector:
    app: {{ .Values.node_selector }}

  {{ $container := (index $ktmz_deployment.spec.template.spec.containers 0) -}}

  {{ if eq (include "someItemHasKey" (list $container.envFrom "configMapRef")) "true" -}}
  configMaps:
    {{- range $def := $container.envFrom }}
      {{- if hasKey $def "configMapRef" }}
    - {{ $def.configMapRef.name }}
      {{- end }}
    {{- end }}
  {{- else -}}
  configMaps: []
  {{- end }}

  {{ if eq (include "someItemHasKey" (list $container.envFrom "secretMapRef")) "true" -}}
  secrets:
    {{- range $def := $container.envFrom }}
      {{- if hasKey $def "secretMapRef" }}
    - {{ $def.secretMapRef.name }}
      {{- end }}
    {{- end }}
  {{- else -}}
  secrets: []
  {{- end }}

  image:
    registry: {{ index (regexSplit "/" $container.image -1) 0 }}
    pullPolicy: {{ $container.imagePullPolicy }}
    repository: {{ index (regexSplit "/" $container.image -1) 1 }}
    tag: ""

  resources:
{{ $container.resources | toYaml | indent 4 }}

  livenessProbe:
{{ $container.livenessProbe | toYaml | indent 4 }}

  readinessProbe:
{{ $container.readinessProbe | toYaml | indent 4 }}

{{ $ktmz_configmap := (.Files.Get "target/kustomize/base/configmap.yaml" | fromYaml) -}}
configmap:
{{- if $ktmz_configmap.data }}
  data:
{{ $ktmz_configmap.data | toYaml | indent 4 }}
{{ else }}
  data: {}
{{- end -}}
